import Image from 'next/image';

### DNS（域名系统）

> 任何客户端设备在访问网站之前的第一步就是“DNS查找”

### 什么是DNS

DNS即域名系统（Domain Name System），是一种用于在互联网上解析域名和 IP 地址之间的映射关系的分布式命名系统。

每个网站都部署在某台服务器上，当输入一个网站例如 `www.bing.com` 时，浏览器如何知道去哪台服务器通信呢？
托管网站的每台计算机都有 IP 地址，因而可以通过 IP 地址来访问网站，而 IP 地址也分为 IPv4 和 IPv6，我们很难去记住每个网站对应的 IP 地址，在这种情况下，我们就需要扩展一种更容易记忆的方式来访问网站，这就是域名。
类似于手机通讯录一样，我们可以通过姓名来查找某个人的电话号码，而不是去记住每个人的电话号码。当我们在浏览器中输入一个网站url，浏览器会通信 DNS 来解析 IP 地址，然后通过返回的真实 IP 地址来访问网站。

由此可见，如果 DNS 停止工作，那么将无法访问任何网站。

### DNS查找

DNS 承担着解析的作用，如果只是一台服务器去存储所有网站的映射，那在每秒亿万次的客户端请求下，单服务器根本无法处理，因此 DNS 采用分布式的方式来存储映射关系。

DNS 系统由多个组件组成，分别是：
- DNS 解析器( DNS Resolver )：负责向 DNS 服务器查询域名信息
- 根域名服务器( Root Server )：负责管理顶级域名服务器
- 顶级域名服务器( TLD(Top-Level Domain) Server )：负责管理权威域名服务器
- 权威域名服务器( Authoritation Name Server )：负责存储该域名的 IP 地址

### DNS 解析器( DNS Resolver )

当首次在浏览器中输入 url 地址时，浏览器并不知晓该网站的 IP 地址，就会首先联系 DNS 解析器，通常 DNS 解析器由互联网服务提供商（ISP）管理。
解析器检查它是否具有与该网站对应的 IP 地址。如果是，则将相同的内容返回给客户端（浏览器）。如果解析器找不到 IP 地址，则会向 DNS 根服务器发送请求。

### 根域名服务器( Root Server )

通常会误认为 `.com`、`.cn`等是根域名，实则`.com`后还有一个`.`，这个`.`才是根域名，根域名服务器是互联网的基础，它们是 DNS 层次结构的顶部，它们是 DNS 解析的第一站。

根服务器在最顶部，负责识别顶级域服务器，有13个不同的根 DNS IP 地址，但在全球范围内分配了上千个不同的根服务器以确保高可用性和冗余。

### 顶级域名服务器( TLD(Top-Level Domain) Server )

顶级域服务器管理和存储对每个网站的实际名称服务器的引用。一旦根服务器识别出顶级域服务器，它就会发送一个 DNS 查询。

### 权威域名服务器( Authoritation Name Server )

顶级域服务器将 DNS 查询转发到权威域服务器，权威域服务器是存储有特定域名信息的服务器，例如 `www.bing.com` 的 IP 地址。

如果网站查询不到，则不会返回任何地址，浏览器将无法访问网站，并显示错误。

### DNS 查询类型

DNS 查询分为两种：递归和迭代。

#### 递归查询

响应从权威名称服务器传播，直到它到达客户端。因此，每个组件负责将请求转发给后续组件。递归 DNS 查询比迭代查询更快。

<Image src="/imgs/DNS.png" alt="dns" width={600} height={400} />

#### 迭代查询

DNS 解析器首先向根服务器发送请求。然后根服务器回复 TLD 服务器的信息。解析器然后查询 TLD 服务器。此外，TLD 服务器会将权威名称服务器返回给解析器。最后，解析器将联系权威名称服务器。

<Image src="/imgs/DNS2.png" alt="dns" width={600} height={400} />

在迭代 DNS 查询中，DNS 解析器主动参与向每个 DNS 组件发送请求。与递归查询不同，DNS 组件之间没有交互。每个组件只是将下一个组件的地址发送给解析器。由于多次来回通信，这些类型的查询需要更长的时间。


### DNS 缓存

DNS 缓存（DNS Cache）是一种机制，用于临时存储最近的DNS查询结果，以提高DNS解析的性能和减少对DNS服务器的负载。当计算机或DNS服务器进行DNS查询并获取了域名与IP地址之间的映射关系时，它可以将这些结果存储在本地缓存中，以备将来使用。

DNS 缓存中的每个条目都有一个 TTL 值，它指定了该条目在缓存中的有效期，一旦 TTL 超时，则被视为过期，需要进行新的 DNS 查询以获取最新的映射关系。TTL 的值由 DNS 记录的所有者设置，通常以秒为单位。